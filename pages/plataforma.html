<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de La Brújula</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>

<body>
    <header class="p-3 text-bg-dark">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start"> <a
                    href="#" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none"> <img
                        class="bi me-2" width="40" height="40" role="img" aria-label="La Brújula"
                        src="../assets/img/logo-base.png"></img>
                </a>
                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="../index.html" class="nav-link px-2 text-secondary">La Brújula</a></li>
                    <li><a href="./metodologia.html" class="nav-link px-2 text-white">Metodología</a></li>
                    <li><a href="#" class="nav-link px-2 text-white">Plataforma</a></li>
                    <li><a href="#" class="nav-link px-2 text-white">Observatorio</a></li>
                    <li><a href="./contacto.html" class="nav-link px-2 text-white">Contacto</a></li>
                </ul>
                <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search"> <input type="search"
                        class="form-control form-control-dark text-bg-dark" placeholder="Search..." aria-label="Search">
                </form>
                <div class="text-end"> <button type="button" class="btn btn-outline-light me-2">Iniciar sesión</button>
                    <button type="button" class="btn btn-warning">Registrarse</button>
                </div>
            </div>
        </div>
    </header>
    <main>
        <h1>PLATAFORMA DE LA BRÚJULA</h1>
        <section class="main-top">
            <div>
                <h2>DERECHO A LAS INFRAESTRUCTURAS</h2>
            </div>
            <div class="selector">
                <label for="layer-select">SELECCIÓN DE VARIABLE:</label>
                <select id="layer-select">
                    <option value="agua">3.1. Provisión de agua potable disponible</option>
                    <option value="cloaca">3.2. Servicio sanitarios o pozos disponibles sin contaminación</option>
                    <option value="drenaje">3.3. Disponibilidad de drenajes que eviten inundación</option>
                    <option value="energia">3.4. Conexión de energía (electricidad y gas)</option>
                    <option value="telecomunicaciones">3.5. Conexión servicios de telecomunicaciones, Internet, etc.
                    </option>
                </select>
            </div>
        </section>
        <section class="map">
            <div id="compass_map"></div>
        </section>
        <section class="compass">

        </section>
    </main>
    <div class="container">
        <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
            <div class="col-md-4 d-flex align-items-center"> <a href="../index.html"
                    class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1" aria-label="La Brújula">
                    <img class="bi" width="24" height="24" src="../assets/img/logo-base.png">
                    </img> </a> <span class="mb-3 mb-md-0 text-body-secondary">© 2025 La Brújula</span> </div>
            <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
                <li><a href="#"><img width="30" height="30" src="../assets/icons/linkedin.png" alt="Linkedin"></a></li>
                <li><a href="#"><img width="30" height="30" src="../assets/icons/x.png" alt="X"></a></li>
                <li><a href="#"><img width="30" height="30" src="../assets/icons/youtube.png" alt="Youtube"></a></li>
            </ul>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js"
        integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Crear el mapa centrado en la ubicación inicial
        let map = L.map('compass_map').setView([-26.71042, -66.04732], 9);

        // Agregar capa base de OpenStreetMap
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Definir capas GeoJSON
        const layers = {
            agua: null,
            cloaca: null,
            energia: null
        };

        // Función para asignar color según coeficiente
        function getColorByCoef(coef) {
            const minColor = [150, 150, 150]; // Blanco para coeficiente 0
            const maxColor = [0, 123, 255];  // Azul intenso para coeficiente 4
            const factor = Math.min(Math.max(coef / 4, 0), 1);
            const r = Math.round(minColor[0] + (maxColor[0] - minColor[0]) * factor);
            const g = Math.round(minColor[1] + (maxColor[1] - minColor[1]) * factor);
            const b = Math.round(minColor[2] + (maxColor[2] - minColor[2]) * factor);
            return `rgb(${r},${g},${b})`;
        }

        // Función para cargar y agregar capas GeoJSON
        function loadGeoJSON(layerName) {
            if (layers[layerName]) {
                map.addLayer(layers[layerName]);
                return;
            }
            fetch(`./data/${layerName}.geojson`)
                .then(response => response.json())
                .then(data => {
                    const layer = L.geoJSON(data, {
                        style: feature => {
                            const coef = feature.properties.coef_agua_corriente || 0;
                            return {
                                color: getColorByCoef(coef),
                                weight: 2,
                                fillOpacity: 0.5
                            };
                        },
                        onEachFeature: (feature, layer) => {
                            const coef_agua_corriente = feature.properties.coef_agua_corriente !== undefined ? feature.properties.coef_agua_corriente : 'Sin coeficiente';
                            layer.bindPopup(`PUNTAJE: <strong>${coef_agua_corriente}</strong>`);
                        }
                    });
                    layers[layerName] = layer;
                    map.addLayer(layer);
                })
                .catch(error => console.error(`Error al cargar ${layerName}:`, error));
        }

        // Manejar cambios en el desplegable
        document.getElementById('layer-select').addEventListener('change', (event) => {
            const selectedLayer = event.target.value;
            // Remover todas las capas antes de agregar la seleccionada
            Object.values(layers).forEach(layer => layer && map.removeLayer(layer));
            loadGeoJSON(selectedLayer);
        });

        // Cargar capa por defecto (Agua)
        loadGeoJSON("agua");
    </script>
</body>

</html>